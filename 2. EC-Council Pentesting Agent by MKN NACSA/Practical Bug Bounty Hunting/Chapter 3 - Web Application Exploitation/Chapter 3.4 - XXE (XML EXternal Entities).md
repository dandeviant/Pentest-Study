**More Reference**
- **[PortSwigger Web Security Academy -  XML external entity (XXE) injection](https://portswigger.net/web-security/xxe)**

---

>[!summary]+ What is XXE?
> XXE is an attack where XML input is provided that contains reference to an **external entity**.
> External entity are such as computer files or documents.
> 
> Example of XXE:
> ```xml
> <?xml version="1.0" encoding="ISO-8859-1"?>
> <!DOCTYPE foo[
> 	<!ELEMENT foo ANY>
> 	<!ENTITY xxe SYSTEM "file:///dev/random" > <!-- file for entity declaration -->
> ]>
> <foo>&xxe;</foo><!-- load the entity defined -->
> ```

## Practical Example with Burp Suite

### Lab 1: Exploiting XXE using external entities to retrieve files

>[!todo]+ Lab Question
> This lab has a "Check stock" feature that parses XML input and returns any unexpected values in the response.
> 
> To solve the lab, inject an XML external entity to retrieve the contents of the `/etc/passwd` file. 

> [!tip] Walkthrough
> 1. Visit a product page, click "Check stock", and intercept the resulting POST request in Burp Suite.
> 2. Insert the following external entity definition in between the XML declaration and the `stockCheck` element: 
>    `<!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>`
> 3. Replace the `productId` number with a reference to the external entity: `&xxe;`. The response should contain "Invalid product ID:" followed by the contents of the `/etc/passwd` file.

**View intercepted packets in Proxy**
![[ECC PA-Bug_Bounty-C3.4-Lab_1-1.png]]

**Send to Repeater, add XXE entity**
![[ECC PA-Bug_Bounty-C3.4-Lab_1-2.png]]

**Forward request packet and view response packet**
![[ECC PA-Bug_Bounty-C3.4-Lab_1-3.png]]
